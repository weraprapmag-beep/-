<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>Monkey King: Math Quest Pro v3</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; font-family: 'Tahoma', sans-serif; touch-action: manipulation; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #5c94fc; display: block; max-width: 100%; max-height: 100%; border: 2px solid #fff; }
        
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; z-index: 20;
        }
        .mario-btn {
            padding: 15px 40px; font-size: 24px; font-weight: bold; cursor: pointer;
            background: #e74c3c; border: 4px solid #fff; border-radius: 10px;
            color: white; text-shadow: 2px 2px #000; transition: 0.1s;
            box-shadow: 0 5px 0 #c0392b; margin: 10px;
        }
        
        .mobile-controls {
            position: absolute; bottom: 20px; left: 0; width: 100%;
            display: flex; justify-content: space-between; padding: 0 30px;
            box-sizing: border-box; pointer-events: none; z-index: 30;
        }
        .joy-btn {
            width: 70px; height: 70px; background: rgba(255,255,255,0.2);
            border: 3px solid #fff; border-radius: 50%; pointer-events: auto;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 30px; user-select: none;
        }

        #quiz-container { background: white; color: #333; padding: 30px; border-radius: 20px; border: 6px solid #f1c40f; text-align: center; width: 85%; max-width: 400px; }
        #feedback { font-weight: bold; margin-top: 10px; height: 25px; }
        input { font-size: 30px; width: 80%; text-align: center; margin: 15px 0; border: 3px solid #3498db; border-radius: 10px; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="game" width="900" height="480"></canvas>
    
    <div id="menu-screen" class="overlay">
        <h1 style="text-align:center; font-size: 45px; text-shadow: 3px 3px #d35400;">MONKEY MATH<br><span style="font-size:22px; color:#f1c40f;">ตะลุยเมฆา ท้าโจทย์ ม.ปลาย</span></h1>
        <button class="mario-btn" onclick="startGame()">START GAME</button>
    </div>

    <div id="quiz-screen" class="overlay" style="display:none;">
        <div id="quiz-container">
            <h2 id="quiz-level" style="color:#e67e22; margin:0;"></h2>
            <h1 id="quiz-question" style="font-size: 40px; margin: 10px 0;"></h1>
            <input type="number" id="quiz-answer" placeholder="?">
            <div id="feedback"></div>
            <button id="submit-btn" class="mario-btn" onclick="processAnswer()" style="font-size:20px; width:100%;">ตอบ!</button>
        </div>
    </div>

    <div id="result-screen" class="overlay" style="display:none;">
        <h1 style="color:#2ecc71; font-size:45px;">ภารกิจสำเร็จ!</h1>
        <p id="final-score" style="font-size: 28px;"></p>
        <button class="mario-btn" onclick="resetToHome()">หน้าหลัก</button>
    </div>

    <div id="over-screen" class="overlay" style="display:none;">
        <h1 style="color:#e74c3c; font-size:50px;">GAME OVER</h1>
        <button class="mario-btn" onclick="startGame()">เริ่มใหม่</button>
    </div>

    <div class="mobile-controls" id="mobile-ui" style="display:none;">
        <div style="display:flex; gap:15px;">
            <div class="joy-btn" id="m-left">◀</div>
            <div class="joy-btn" id="m-right">▶</div>
        </div>
        <div class="joy-btn" id="m-jump" style="width:85px; height:85px; background:rgba(231, 76, 60, 0.6);">JUMP</div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let state = "menu", currentLv = 1, hearts = 3, score = 0, cameraX = 0;
const gravity = 0.8;

const player = { x: 100, y: 300, w: 40, h: 50, vx: 0, vy: 0, speed: 6, jump: -15, onGround: false, jumpCount: 0 };
const platforms = [], obstacles = [], clouds = [];
const questions = [
    { q: "log₂(32) = ?", a: "5" },
    { q: "sin(30°) × 2 = ?", a: "1" },
    { q: "d/dx (3x²) ที่ x=2 ?", a: "12" },
    { q: "5! / 20 = ?", a: "6" },
    { q: "2^x = 1/4, x = ?", a: "-2" }
];

// --- สร้างเมฆ ---
function initClouds() {
    clouds.length = 0;
    for(let i=0; i<15; i++) {
        clouds.push({ x: i * 300 + Math.random()*100, y: 50 + Math.random()*150, w: 100 + Math.random()*50 });
    }
}

function initLevel() {
    platforms.length = 0; obstacles.length = 0;
    cameraX = 0; player.x = 100; player.y = 300; player.vx = 0; player.vy = 0; player.jumpCount = 0;
    
    platforms.push({x: 0, y: 430, w: 900, h: 50});
    platforms.push({x: 1050, y: 320, w: 220, h: 30});
    platforms.push({x: 1400, y: 220, w: 250, h: 30});
    platforms.push({x: 1800, y: 340, w: 300, h: 30});
    platforms.push({x: 2300, y: 430, w: 800, h: 50});
    
    obstacles.push({x: 650, y: 400, w: 45, h: 30});
    obstacles.push({x: 1950, y: 310, w: 45, h: 30});
}

// --- Input & Controls ---
const mInput = { left: false, right: false };
const keys = {};
window.onkeydown = e => { keys[e.code] = true; if(e.code === "Space") doJump(); };
window.onkeyup = e => keys[e.code] = false;

function bindMobile(id, prop) {
    const el = document.getElementById(id);
    const start = (e) => { e.preventDefault(); if(prop) mInput[prop] = true; else doJump(); };
    const end = (e) => { e.preventDefault(); if(prop) mInput[prop] = false; };
    el.addEventListener("touchstart", start); el.addEventListener("touchend", end);
}
bindMobile("m-left", "left"); bindMobile("m-right", "right"); bindMobile("m-jump", null);

function doJump() {
    if(state !== "play") return;
    if(player.onGround) {
        player.vy = player.jump; player.onGround = false; player.jumpCount = 1;
    } else if(player.jumpCount < 2) {
        player.vy = player.jump * 0.85; player.jumpCount = 2;
    }
}

// --- Quiz Logic ---
function processAnswer() {
    const ansInput = document.getElementById("quiz-answer");
    const feedback = document.getElementById("feedback");
    const submitBtn = document.getElementById("submit-btn");
    
    submitBtn.disabled = true;
    
    if(ansInput.value === questions[currentLv-1].a) {
        score++;
        feedback.style.color = "#2ecc71";
        feedback.innerText = "ถูกต้อง! บรรลุวิชา!";
    } else {
        feedback.style.color = "#e74c3c";
        feedback.innerText = "เจ้ายังไม่ฉลาดพอ!";
    }

    setTimeout(() => {
        currentLv++;
        ansInput.value = "";
        feedback.innerText = "";
        submitBtn.disabled = false;
        
        if(currentLv > 5) {
            state = "result"; hideAll();
            document.getElementById("result-screen").style.display = "flex";
            document.getElementById("final-score").innerText = `คะแนนความฉลาด: ${score}/5`;
        } else {
            state = "play"; hideAll();
            document.getElementById("mobile-ui").style.display = "flex";
            initLevel();
        }
    }, 1500);
}

function startGame() {
    state = "play"; currentLv = 1; hearts = 3; score = 0;
    hideAll(); initClouds(); initLevel();
    document.getElementById("mobile-ui").style.display = "flex";
}

function resetToHome() { state = "menu"; hideAll(); document.getElementById("menu-screen").style.display = "flex"; }
function hideAll() { ["menu-screen", "quiz-screen", "result-screen", "over-screen", "mobile-ui"].forEach(id => document.getElementById(id).style.display = "none"); }

function update() {
    if(state === "play") {
        if(keys["ArrowLeft"] || mInput.left) player.vx = -player.speed;
        else if(keys["ArrowRight"] || mInput.right) player.vx = player.speed;
        else player.vx *= 0.8;

        player.vy += gravity;
        player.x += player.vx;
        player.y += player.vy;

        player.onGround = false;
        platforms.forEach(p => {
            if(player.x < p.x + p.w && player.x + player.w > p.x && player.y + player.h > p.y && player.y + player.h < p.y + player.vy + 10) {
                player.y = p.y - player.h; player.vy = 0; player.onGround = true; player.jumpCount = 0;
            }
        });

        obstacles.forEach(o => {
            if(player.x < o.x + o.w && player.x + player.w > o.x && player.y < o.y + o.h && player.y + player.h > o.y) die();
        });

        if(player.y > 500) die();
        cameraX = player.x - 150;
        if(cameraX < 0) cameraX = 0;
        if(player.x > 2800) {
            state = "quiz"; hideAll();
            document.getElementById("quiz-screen").style.display = "flex";
            document.getElementById("quiz-level").innerText = `ข้อที่ ${currentLv}`;
            document.getElementById("quiz-question").innerText = questions[currentLv-1].q;
            setTimeout(() => document.getElementById("quiz-answer").focus(), 100);
        }
    }
}

function die() {
    hearts--;
    if(hearts <= 0) { state = "gameover"; hideAll(); document.getElementById("over-screen").style.display = "flex"; }
    else { player.x = 100; player.y = 300; player.vx = 0; player.vy = 0; cameraX = 0; }
}

function draw() {
    ctx.clearRect(0, 0, 900, 480);
    
    // วาดพื้นหลัง (เมฆ)
    ctx.save();
    ctx.translate(-cameraX * 0.3, 0); // เมฆเลื่อนช้าๆ แบบ Parallax
    ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
    clouds.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.w/2, 0, Math.PI*2);
        ctx.arc(c.x - c.w/3, c.y + 10, c.w/3, 0, Math.PI*2);
        ctx.arc(c.x + c.w/3, c.y + 10, c.w/3, 0, Math.PI*2);
        ctx.fill();
    });
    ctx.restore();

    if(state === "play") {
        ctx.save();
        ctx.translate(-cameraX, 0);

        // วาดพื้น & หนาม
        ctx.fillStyle = "#8b4513";
        platforms.forEach(p => {
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(p.x, p.y, p.w, 10); ctx.fillStyle = "#8b4513";
        });
        ctx.fillStyle = "#333";
        obstacles.forEach(o => {
            ctx.beginPath(); ctx.moveTo(o.x, o.y+o.h); ctx.lineTo(o.x+o.w/2, o.y); ctx.lineTo(o.x+o.w, o.y+o.h); ctx.fill();
        });

        // หงอคง
        ctx.fillStyle = "#e67e22";
        if(player.jumpCount === 2) { ctx.shadowBlur = 15; ctx.shadowColor = "yellow"; }
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#f1c40f"; ctx.fillRect(player.x+5, player.y-5, player.w-10, 5);

        // ธงเส้นชัย
        ctx.fillStyle = "#fff"; ctx.fillRect(2850, 150, 5, 280);
        ctx.fillStyle = "#e74c3c"; ctx.fillRect(2855, 150, 40, 30);
        ctx.restore();

        // UI
        ctx.fillStyle = "white"; ctx.font = "bold 22px Tahoma";
        ctx.fillText(`LIFE: ${"❤️".repeat(hearts)}`, 20, 40);
        ctx.fillText(`ด่าน: ${currentLv}/5`, 780, 40);
    }
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
    
  </body>
  
</html>
